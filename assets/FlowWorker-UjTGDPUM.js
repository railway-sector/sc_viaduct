import{n as m,u as g}from"./index-cm-L_i_x.js";import{f as h,d as w}from"./dataUtils-BoChRzTn.js";import{x as D,f as _}from"./loadUtils-BC_T1iRl.js";import"./FeatureTileDescriptor-Cv3NQ-uW.js";let c=class{constructor(){this._tileData=new Map}async generateStreamlines(i){const{flowData:n,flowExtentInfo:t,needsMagnitude:e,simulationSettings:l,startPositions:f}=i,o=d(h(l,n),l,t.modelSize,e,f);return{result:{streamlines:o},transferList:o?.map(a=>a.vertices.buffer)}}async generateTiledStreamlines(i){const{flowDataTiles:n,flowExtentInfo:t,needsMagnitude:e,reset:l,simulationSettings:f,startPositions:o}=i;this._updateTileData(n,l);const a=d(D(f,this._tileData,t),f,t.modelSize,e,o);return{result:{streamlines:a},transferList:a?.map(r=>r.vertices.buffer)??[]}}_updateTileData(i,n){n&&this._tileData.forEach((t,e)=>{i.get(e)==null&&this._tileData.delete(e)}),i.forEach((t,e)=>{t.type==="delete"?this._tileData.delete(e):t.type!=="on-worker"&&t.type!=="waiting"&&this._tileData.set(e,t.data)})}};c=m([g("esri.views.3d.support.flow.FlowWorker")],c);const E=c;function d(i,n,t,e,l){if(i==null)return;const f=w(n,i,t[0],t[1],{positions:l}),o=[],a=_(e);for(const{vertices:r,stage:p}of f){const u=new Float32Array(r.length*a);for(let s=0;s<r.length;s++)u[s*a]=r[s].x,u[s*a+1]=r[s].y,u[s*a+2]=r[s].t,e&&(u[s*a+3]=r[s].speed);o.push({vertices:u,stage:p,hasMagnitude:e})}return o}export{E as default};
