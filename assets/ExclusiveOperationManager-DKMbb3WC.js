import{aD as v,N as y,aI as O,aG as o,gX as u,i as S,aJ as m}from"./index-DxtJ83V_.js";class w{constructor(){this._currentOperationSignal=v(null)}get currentOperationType(){return this._currentOperationSignal.value?.type??null}destroy(){this.stop()}async start(p,c,h){const e=this._currentOperationSignal.value;e?.stop();const n=new AbortController,i=h?.signal,s=AbortSignal.any([n.signal,i].filter(y)),a=O();let r=!1;const l=()=>{r||(r=!0,a.reject(m()))},t={type:p,resolve:g=>{r||(r=!0,a.resolve(g))},reject:l,promise:a.promise,stop:()=>n.abort(),handles:[]};this._currentOperationSignal.value=t,t.handles.push(o(i,()=>{n.abort()}),o(s,()=>{u(t.handles),r||l()}));try{return e&&(await e.promise.catch(()=>{}),S(s)),await c(t,s),await a.promise}finally{u(t.handles),this._currentOperationSignal.value===t&&(this._currentOperationSignal.value=null)}}stop(){this._currentOperationSignal.value?.stop()}}export{w as s};
