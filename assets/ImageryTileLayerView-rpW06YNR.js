import{n,p as s,u as P,e as _,gR as j,bg as L}from"./index-BkKIpdnN.js";import{V as $,i as l,a as A}from"./rasterFieldUtils-BFCgOS3a.js";import{i as z}from"./timeSupport-CanIz24Q.js";import{t as C}from"./datasetUtils-DdDUWBI2.js";import{v as D,u as x,I as N}from"./rasterProjectionHelper-BjIXOZUQ.js";const J=E=>{const w=E;let r=class extends w{constructor(...t){super(...t),this.layer=null,this.tileInfo=null}get fullExtent(){try{return this.layer.loaded?this._getFullExtent():null}catch{return null}}get timeExtent(){return z(this.layer,this.view?.timeExtent,this._get("timeExtent"))}get hasTilingEffects(){const{renderer:t}=this.layer;return!!(t?.type==="raster-stretch"&&t.dynamicRangeAdjustment&&!(t.stretchType==="min-max"||t.stretchType==="standard-deviation"))}get datumTransformation(){try{return this.layer.loaded?D(this.layer.fullExtent,this.view.spatialReference,!0):null}catch{return null}}supportsSpatialReference(t){try{return!this.layer.loaded||!!x(this.layer.serviceRasterInfo,t)}catch{return!1}}async fetchPopupFeaturesAtLocation(t,p){const{layer:e}=this;if(!t)throw new _("imageryTileLayerView:fetchPopupFeatures","Nothing to fetch without area",{layer:e});const{popupEnabled:T}=e,R=j(e,p);if(!T||R==null)return[];const f=[],{value:o,magdirValue:h,processedValue:b}=await e.identify(t,{timeExtent:this.timeExtent,signal:p?.signal});let c="";if(o?.length){c=e.type==="imagery-tile"&&e.hasStandardTime()&&o[0]!=null?o.map(y=>e.getStandardTimeValue(y)).join(", "):o.join(", ");const i={ObjectId:0};i[l.servicePixelValue]=e.type==="imagery-tile"&&C(e.raster)?b?.join(", "):c,i[l.rawServicePixelValue]=c;const m=e.raster?.rasterInfo??e.serviceRasterInfo,d=m?.attributeTable;if(d!=null){const{fields:y,features:F}=d,v=y.find(({name:a})=>a.toLowerCase()==="value"),O=i[l.servicePixelValue],u=v?F.find(a=>String(a.attributes[v.name])===O):null;if(u)for(const a in u.attributes)u.attributes.hasOwnProperty(a)&&(i[A+a]=u.attributes[a])}const g=m?.dataType;g!=="vector-magdir"&&g!=="vector-uv"||(i[l.magnitude]=h?.[0],i[l.direction]=h?.[1]);const{multidimensionalDefinition:I}=this.layer.normalizeRasterFetchOptions({timeExtent:this.timeExtent});$(e.rasterFields,i,I);const{graphicOrigin:V}=e,S=new L({geometry:this.fullExtent?.clone(),attributes:i,layer:e,origin:V,sourceLayer:e});f.push(S)}return f}async getSourceScale(){return await this.layer.load(),N(this.layer.serviceRasterInfo,this.view.spatialReference)}_getFullExtent(){return x(this.layer.serviceRasterInfo,this.view.spatialReference)}};return n([s()],r.prototype,"fullExtent",null),n([s()],r.prototype,"layer",void 0),n([s({readOnly:!0})],r.prototype,"timeExtent",null),n([s()],r.prototype,"tileInfo",void 0),n([s({readOnly:!0})],r.prototype,"hasTilingEffects",null),n([s()],r.prototype,"datumTransformation",null),r=n([P("esri.views.layers.ImageryTileLayerView")],r),r};export{J as f};
